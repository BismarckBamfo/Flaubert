# | sed -e 's/\(.*\)/\L\1/' \

bash submit_sequential_jobs_slurm.sh 1 /gpfswork/rech/wod/umz16dj/BERT_FR/code/experiments/test_jz_wiki_BPE30k.cfg
bash submit_sequential_jobs_slurm.sh 1 /gpfswork/rech/wod/umz16dj/BERT_FR/code/experiments/full_fr_bpe50k_roberta_base.cfg

# Test in interactive

source /gpfswork/rech/wod/umz16dj/BERT_FR/code/experiments/full_fr_bpe50k_roberta_base.cfg

srun python train.py \
    --exp_name $EXPNAME \
    --dump_path $OUTPUTPATH \
    --data_path $DATAPATH \
    --reload_checkpoint "" \
    --amp 1 \
    --lgs "$LANGUAGE" \
    --clm_steps '' \
    --mlm_steps "$LANGUAGE" \
    --emb_dim $EMB_DIM \
    --n_layers $LAYERS \
    --n_heads $HEADS \
    --dropout 0.1 \
    --attention_dropout 0.1 \
    --gelu_activation true \
    --batch_size $BATCH_SIZE \
    --bptt $MAX_LEN \
    --optimizer adam_inverse_sqrt,lr=0.0006,warmup_updates=24000,beta1=0.9,beta2=0.98,weight_decay=0.01,eps=0.000001 \
    --epoch_size $EPOCH_SIZE \
    --max_epoch 100000 \
    --validation_metrics _valid_fr_mlm_ppl \
    --stopping_criterion _valid_fr_mlm_ppl,20 \
    --fp16 true \
    --accumulate_gradients $ACCUM_GRAD \
    --word_mask_keep_rand '0.8,0.1,0.1' \
    --word_pred '0.15' \
    |& tee $OUTPUTPATH/$EXPNAME/output.log

# Copy data from decore1 to Jean Zay:
Connect to ligone and run:
scp -3 -r lethip@decore1.imag.fr:/home/getalp/lethip/Data/BERT-FR/data_processed/combined_corpus/BPE/50k_local_rank_4 umz16dj@jean-zay.idris.fr:/gpfsscratch/rech/wod/umz16dj/Data/BERT-FR/

# Copy data from Jean Zay to decore1:
Connect to ligone and run:
scp -3 -r umz16dj@jean-zay.idris.fr:/gpfsscratch/some_folder lethip@decore1.imag.fr:/home/getalp/lethip/Data/BERT-FR/

This command will copy some_folder on JZ to BERT-FR on decore1: BERT-FR now contains some_folder.


rsync -chavzP --stats umz16dj@jean-zay.idris.fr:/gpfsscratch/rech/wod/umz16dj/Models/RoBERTa_base_4nodes_32gpus/RoBERTa_base_embdim_768_layers_12_heads_12_batch_16_accumgrad_16_epochsize_300000/143266 /Users/hang/BERT-FRA/

rsync -chavzP --stats umz16dj@jean-zay.idris.fr:/gpfsscratch/rech/wod/umz16dj/Models/RoBERTa_large_128nodes/RoBERTa_large_embdim_1024_layers_24_heads_16_batch_8_accumgrad_2_epochsize_300000/179416 /Users/hang/BERT-FRA/

rsync -chavzP --stats umz16dj@jean-zay.idris.fr:/gpfswork/rech/wod/umz16dj/BERT_FR/code/full_RoBERTa_large_177654.out /Users/hang/BERT-FRA/

rsync -chavzP --stats umz16dj@jean-zay.idris.fr:/gpfsscratch/rech/wod/umz16dj/Experiments_Finetune /Users/hang/BERT-FRA/

rsync -chavzP --stats /Users/hang/Google\ Drive/DSBA/INTERNSHIP/BERT_FR/code umz16dj@jean-zay.idris.fr:/gpfsscratch/rech/wod/umz16dj/

rsync -chavzP --stats /Users/hang/BERT-FRA/179416 lethip@decore1.imag.fr:/home/getalp/lethip/Experiments/JeanZay/RoBERTa/Large/

scp -3 -r lethip@decore1.imag.fr:/home/getalp/lethip/Data/Finetune-BERT-FR/pawsx umz16dj@jean-zay.idris.fr:/gpfsscratch/rech/wod/umz16dj/Data/Finetune-BERT-FR/

rsync -chavzP --stats umz16dj@jean-zay.idris.fr:/gpfsscratch/rech/wod/umz16dj/Experiments_Finetune /Users/hang/BERT-FRA/

# Run fine-tuning of CamemBERT
CUDA_VISIBLE_DEVICES=1 bash run-finetune-cmbert-lig.sh ./experiments_finetune/cmbert/pawsx_cmbert_bs8_lr1e-5.cfg

rsync -chavzP --stats /Users/hang/github/formiel/learn-pytorch usq66zd@jean-zay.idris.fr:/gpfsscratch/rech/wod/usq66zd/

rsync -chavzP --stats /Users/hang/github/formiel/learn-pytorch lethip@decore1.imag.fr:/home/getalp/lethip/

scp -3 -r lethip@decore1.imag.fr:/home/getalp/lethip/Data/BERT-FR/data_processed/combined_corpus_nc/BPE/50k usq66zd@jean-zay.idris.fr:/gpfsscratch/rech/wod/usq66zd/Data/BERT-FR/


scp -3 -r \
    lethip@decore2.imag.fr:/home/getalp/lethip/shared/TKM/toto.txt \
    lethip@decore1.imag.fr:/home/getalp/lethip/shared/JZ/


scp -3 -r \
    usq66zd@jean-zay.idris.fr:/gpfsscratch/rech/wod/usq66zd/*.stderr \
    schwab@decore1.imag.fr:/home/getalp/lethip/shared/JZ/

scp -3 -r \
    usq66zd@jean-zay.idris.fr:/gpfsscratch/rech/wod/usq66zd/*.out \
    schwab@decore1.imag.fr:/home/getalp/lethip/shared/JZ/

scp -3 -r \
    usq66zd@jean-zay.idris.fr:/gpfsscratch/rech/wod/usq66zd/Models/Flaubert_large_normal/Flaubert_large_layerdrop_0.2_prenorm_true_layer_norm_eps_1e-6/<jobID>/train.log \
    schwab@decore1.imag.fr:/home/getalp/lethip/shared/JZ/ 

scp -3 -v usq66zd@jean-zay.idris.fr:/gpfsscratch/rech/wod/usq66zd/Flaubert/large_normal_drop_prenorm_* schwab@decore1.imag.fr:/home/getalp/lethip/shared/JZ/

scp -3 -v usq66zd@jean-zay.idris.fr:/gpfsscratch/rech/wod/usq66zd/Flaubert/large_normal_drop_prenorm_ ./

Host decore0.imag.fr decore1.imag.fr decore2.imag.fr dvorak0.imag.fr aker.imag.fr jean-zay.idris.fr
    ProxyCommand ssh -o 'ForwardAgent yes' schwab@ligone.imag.fr 'ssh-add && nc %h %p'

rsync -chavzP --stats usq66zd@jean-zay.idris.fr:/gpfsscratch/rech/wod/usq66zd/Flaubert/large_normal_drop_prenorm_503438.* ./